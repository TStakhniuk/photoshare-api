# Photos Module - Частина роботи: CRUD світлин, теги, Cloudinary

## Реалізовані задачі
- **2.1-2.4**: CRUD світлин (POST, DELETE, PUT, GET)
- **2.5-2.6**: Система тегів (до 5 тегів на фото, унікальні теги)
- **2.7**: Інтеграція Cloudinary (завантаження, трансформації, QR-коди)

## Структура модуля

```
src/
├── photos/
│   ├── __init__.py       # Експорти модуля
│   ├── models.py         # SQLAlchemy моделі (Photo, Tag, PhotoTransformation)
│   ├── schemas.py        # Pydantic схеми
│   ├── repository.py     # Робота з БД
│   └── routes.py         # API ендпоінти
└── services/
    ├── cloudinary.py     # Сервіс Cloudinary
    └── qrcode.py         # Сервіс QR-кодів
```

## API Ендпоінти

| Метод | URL | Опис |
|-------|-----|------|
| POST | `/photos/` | Завантажити фото |
| GET | `/photos/` | Отримати всі фото (пагінація) |
| GET | `/photos/search` | Пошук фото за фільтрами |
| GET | `/photos/{id}` | Отримати фото за ID |
| PUT | `/photos/{id}` | Оновити опис фото |
| DELETE | `/photos/{id}` | Видалити фото |
| POST | `/photos/{id}/transform` | Застосувати трансформацію |
| GET | `/photos/{id}/transformations` | Отримати всі трансформації |
| GET | `/photos/{id}/qr` | Отримати QR-код для фото |
| GET | `/photos/user/{user_id}` | Отримати фото користувача |

## Необхідні зміни в інших файлах

### 1. `src/conf/settings.py` - додати налаштування Cloudinary:

```python
# Cloudinary settings
CLOUDINARY_CLOUD_NAME: str = ""
CLOUDINARY_API_KEY: str = ""
CLOUDINARY_API_SECRET: str = ""
```

### 2. `src/users/models.py` - додати зв'язок з фото:

```python
photos: Mapped[list["Photo"]] = relationship("Photo", back_populates="user", lazy="selectin")
```

### 3. `.env.example` - додати змінні Cloudinary:

```
# Cloudinary
CLOUDINARY_CLOUD_NAME=
CLOUDINARY_API_KEY=
CLOUDINARY_API_SECRET=
```

### 4. `src/main.py` - підключити роутер:

```python
from src.photos.routes import router as photos_router

app.include_router(photos_router, prefix="/photos", tags=["photos"])
```

## Залежності

Додати в `pyproject.toml`:
```toml
cloudinary = "^1.36.0"
qrcode = { version = "^7.4.2", extras = ["pil"] }
pillow = "^10.0.0"
```

## Трансформації Cloudinary

Доступні трансформації:
- `circle` - кругле обрізання
- `rounded` - закруглені кути
- `grayscale` - чорно-біле
- `sepia` - сепія
- `blur` - розмиття

## Моделі БД

### Photo
- `id` - первинний ключ
- `user_id` - FK на users
- `url` - URL зображення в Cloudinary
- `cloudinary_public_id` - ID в Cloudinary
- `description` - опис фото
- `created_at`, `updated_at` - timestamps
- Зв'язки: `user`, `tags`, `comments`, `transformations`

### Tag
- `id` - первинний ключ
- `name` - унікальна назва тегу
- `created_at` - timestamp
- Зв'язок Many-to-Many з Photo через `photo_tags`

### PhotoTransformation
- `id` - первинний ключ
- `original_photo_id` - FK на photos
- `url` - URL трансформованого зображення
- `cloudinary_public_id` - ID в Cloudinary
- `transformation_params` - JSON параметри трансформації
- `qr_code_url` - Base64 QR-код
- `created_at` - timestamp

## Автор
mitus66 | Дмитрo Маслаков
